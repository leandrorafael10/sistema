<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:ui="http://java.sun.com/jsf/facelets"
      >
    <ui:composition template="./../../principal/templategreen.xhtml" >
        <ui:define name="principal-interna">
            <f:view>
                <h:form id="for_listar_debito">
                    <p:panel>
                        <p:commandButton value="Atualizar" update=":for_listar_debito"/>
                        <br/>
                        <br/>
                        <p:dataTable value="#{despesaRN.pendentesPagamento()}" 
                                     var="despesa" 
                                     scrollable="true" scrollHeight="400" 
                                     emptyMessage="Sem registros"
                                     resizableColumns="true"
                                     rowStyleClass="#{despesa.pago!=true ?(despesa.DTVencimento le despesaBean.dataAtual? 'vermelho':(despesa.DTVencimento ge despesaBean.hoje ? 'verde':'azul')):'amarelo'}">
                            <f:facet name="header">
                                Todas despesas
                            </f:facet>
                            <p:column headerText="Empresa" width="80" filterBy="#{despesa.IDConta.titular}" sortBy="#{despesa.IDConta.titular}">
                                <h:outputText value="#{despesa.IDConta.titular}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Vencimento" width="60">
                                <h:outputText value="#{despesa.DTVencimento}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Cedente" width="180"> 
                                <h:outputText value="#{despesa.IDCliente.IDPessoa.razao}(cliente)" rendered="#{despesa.IDCliente!=null}"/>
                                <h:outputText value="#{despesa.IDFuncionario.IDPessoa.razao}(funcionario)" rendered="#{despesa.IDFuncionario!=null}"/>
                                <h:outputText value="#{despesa.IDFornecedor.IDPessoa.razao}(fornecedor)" rendered="#{despesa.IDFornecedor!=null}"/>
                                <h:outputText value="sem cedente" rendered="#{despesa.IDCliente== null and despesa.IDFuncionario==null and despesa.IDFornecedor==null}"/>
                            </p:column>
                            <p:column headerText=" Valor liquido" width="70">
                                <h:outputText value="R$ "/>
                                <h:outputText value="#{despesa.valorLiquido}">
                                    <f:convertNumber maxFractionDigits="2" minFractionDigits="2"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Tipo" width="100">
                                <h:outputText value="#{despesa.IDClassificacao.descricao}"/>
                            </p:column>
                            <p:column width="40">
                                <p:commandLink  actionListener="#{despesaBean.depesaVisualizacao(despesa)}" >
                                    <h:graphicImage library="imagens" name="Pesq.png"  title="visualizar"/>
                                </p:commandLink>
                            </p:column>

                            <p:column width="40">
                                <p:commandLink actionListener="#{despesaBean.calcularTaxa(despesa)}" immediate="true" rendered="#{despesa.pago==false}" onstart="statusDialog.show();" onsuccess="statusDialog.hide();">
                                    <h:graphicImage library="imagens" name="money_32x32.png" title="pagar"/>
                                </p:commandLink>
                                <h:graphicImage library="imagens" name="money-paga_32x32.png" title="pagar" rendered="#{despesa.pago}"/>
                            </p:column>

                        </p:dataTable>
                    </p:panel>
                    <p:dialog widgetVar="varDialogDespesa" modal="true" header="Dados da despesa">
                        <h:panelGrid columns="2">
                            <h:outputText value="Data emição: "/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.DTEmissao}" >
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputText value="Tipo Doc.: "/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.IDDocumento.descricao}"/>
                            <h:outputText value="Numero: "/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.numero}"/>
                            <h:outputText value="Entidade: " rendered="#{despesaBean.despesaPesquisa.IDCliente!=null or despesaBean.despesaPesquisa.IDFuncionario!=null or despesaBean.despesaPesquisa.IDFornecedor!=null}"/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.IDCliente.IDPessoa.razao}" rendered="#{despesaBean.despesaPesquisa.IDCliente!=null}"/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.IDFuncionario.IDPessoa.razao}" rendered="#{despesaBean.despesaPesquisa.IDFuncionario!=null}"/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.IDFornecedor.IDPessoa.razao}" rendered="#{despesaBean.despesaPesquisa.IDFornecedor!=null}"/>
                            <h:outputText value="Atividade Fin.: "/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.IDAtividade.descricao}"/>
                            <h:outputText value="Centro Custo: " />
                            <h:outputText value="#{despesaBean.despesaPesquisa.IDCCusto.descricao}"/>
                            <h:outputText value="Plano de Conta: "/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.IDClassificacao.descricao}"/>
                            <h:outputText value="Vencimento: "/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.DTVencimento}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputText value="Conta:"/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.IDConta.titular} / Banco:#{despesaBean.despesaPesquisa.IDConta.IDBanco.descricao}"/>
                        </h:panelGrid>
                        <h:panelGrid columns="5">
                            <h:outputText value="Multa: R$" rendered="#{despesaBean.despesaPesquisa.valorMulta!='0.00'}"/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.valorMulta}" rendered="#{despesaBean.despesaPesquisa.valorMulta !='0.00'}">
                                <f:convertNumber maxFractionDigits="2" minFractionDigits="2"/>
                            </h:outputText>
                            <h:outputText value="#{despesaBean.despesaPesquisa.DTMulta==null?'':'limite '}" rendered="#{despesaBean.despesaPesquisa.valorMulta!='0.00'}" />
                            <h:outputText value="#{despesaBean.despesaPesquisa.DTMulta}" rendered="#{despesaBean.despesaPesquisa.DTMulta!=null and despesaBean.despesaPesquisa.valorMulta!='0.00'}" >
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputText value="" rendered="#{despesaBean.despesaPesquisa.DTMulta==null?true:false}" />
                            <h:outputText value="#{despesaBean.despesaPesquisa.isentoMulta?'isento':''}" style="color: blue"/>
                        </h:panelGrid>
                        <h:panelGrid columns="4">
                            <h:outputText value="Juros: R$" rendered="#{despesaBean.despesaPesquisa.valorJuros!='0.00'}"/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.valorJuros}" rendered="#{despesaBean.despesaPesquisa.valorJuros!='0.00'}">
                                <f:convertNumber maxFractionDigits="2" minFractionDigits="2"/>
                            </h:outputText>
                            <h:outputText value="#{despesaBean.despesaPesquisa.tipoJuros?'dia':'mês'}" rendered="#{despesaBean.despesaPesquisa.valorJuros!='0.00'}"/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.isentoJuros?'isento':''}" style="color: blue" rendered="#{despesaBean.despesaPesquisa.valorJuros!='0.00'}"/>

                            <h:outputText value="Desconto: R$" rendered="#{despesaBean.despesaPesquisa.valorDesconto!='0.00'}"/>
                            <h:outputText value="#{despesaBean.despesaPesquisa.valorDesconto}" rendered="#{despesaBean.despesaPesquisa.valorDesconto!='0.00'}">
                                <f:convertNumber maxFractionDigits="2" minFractionDigits="2"/>
                            </h:outputText>
                            <h:outputText value="#{despesaBean.despesaPesquisa.DTDesconto==null?'':'limite '}" rendered="#{despesaBean.despesaPesquisa.valorDesconto!='0.00'}" />
                            <h:outputText value="#{despesaBean.despesaPesquisa.DTDesconto}" rendered="#{despesaBean.despesaPesquisa.DTDesconto!=null and despesaBean.despesaPesquisa.valorDesconto!='0.00'}" >
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                            <h:outputText value="" rendered="#{despesaBean.despesaPesquisa.DTDesconto==null?true:false}" />
                        </h:panelGrid>
                        <br/>
                        <h:outputText value="Valor nominal: "/>
                        <h:outputText value="#{despesaBean.despesaPesquisa.valorNominal}" styleClass="azul">
                            <f:convertNumber maxFractionDigits="2" minFractionDigits="2"/>
                        </h:outputText>
                        <br/>
                        <h:outputText value="Valor liquido: "/>
                        <h:outputText value="#{despesaBean.despesaPesquisa.valorLiquido}" styleClass="azul">
                            <f:convertNumber maxFractionDigits="2" minFractionDigits="2"/>
                        </h:outputText>
                    </p:dialog>

                </h:form>
                <h:form id="forPagar_debito">
                    <p:dialog widgetVar="varDialogDespesaPagar" modal="true" header="Dados da despesa">
                        <p:panel id="panelConfirPagDebito">
                            <p:messages/>
                            <h:panelGrid columns="2">

                                <h:outputText value="Data emição: "/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.DTEmissao}" >
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                                <h:outputText value="Tipo Doc.: "/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.IDDocumento.descricao}"/>
                                <h:outputText value="Numero: "/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.numero}"/>
                                <h:outputText value="Cedente: " rendered="#{despesaBean.despesadebito.IDDespesa.IDCliente!=null or despesaBean.despesadebito.IDDespesa.IDFuncionario!=null or despesaBean.despesadebito.IDDespesa.IDFornecedor!=null}"/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.IDCliente.IDPessoa.razao}" rendered="#{despesaBean.despesadebito.IDDespesa.IDCliente!=null}"/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.IDFuncionario.IDPessoa.razao}" rendered="#{despesaBean.despesadebito.IDDespesa.IDFuncionario!=null}"/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.IDFornecedor.IDPessoa.razao}" rendered="#{despesaBean.despesadebito.IDDespesa.IDFornecedor!=null}"/>
                                <h:outputText value="Atividade Fin.: "/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.IDAtividade.descricao}"/>
                                <h:outputText value="Centro Custo: " />
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.IDCCusto.descricao}"/>
                                <h:outputText value="Plano de Conta: "/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.IDClassificacao.descricao}"/>
                                <h:outputText value="Vencimento: "/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.DTVencimento}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                                <h:outputText value="Conta:"/>
                            <h:outputText value="#{despesaBean.despesadebito.IDDespesa.IDConta.titular} / Banco:#{despesaBean.despesadebito.IDDespesa.IDConta.IDBanco.descricao}"/>
                            </h:panelGrid>
                            <h:panelGrid columns="5">
                                <h:outputText value="Multa: R$" rendered="#{despesaBean.despesadebito.IDDespesa.valorMulta!='0.00'}"/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.valorMulta}" rendered="#{despesaBean.despesadebito.IDDespesa.valorMulta !='0.00'}">
                                    <f:convertNumber maxFractionDigits="2" minFractionDigits="2"/>
                                </h:outputText>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.DTMulta==null?'':'limite '}" rendered="#{despesaBean.despesadebito.IDDespesa.valorMulta!='0.00'}" />
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.DTMulta}" rendered="#{despesaBean.despesadebito.IDDespesa.DTMulta!=null and despesaBean.despesadebito.IDDespesa.valorMulta!='0.00'}" >
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                                <h:outputText value="" rendered="#{despesaBean.despesadebito.IDDespesa.DTMulta==null?true:false}" />
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.isentoMulta?'isento':''}" style="color: blue"/>
                            </h:panelGrid>
                            <h:panelGrid columns="4">
                                <h:outputText value="Juros: R$" rendered="#{despesaBean.despesadebito.IDDespesa.valorJuros!='0.00'}"/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.valorJuros}" rendered="#{despesaBean.despesadebito.IDDespesa.valorJuros!='0.00'}">
                                    <f:convertNumber maxFractionDigits="2" minFractionDigits="2"/>
                                </h:outputText>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.tipoJuros?'dia':'mês'}" rendered="#{despesaBean.despesadebito.IDDespesa.valorJuros!='0.00'}"/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.isentoJuros?'isento':''}" style="color: blue" rendered="#{despesaBean.despesadebito.IDDespesa.valorJuros!='0.00'}"/>

                                <h:outputText value="Desconto: R$" rendered="#{despesaBean.despesadebito.IDDespesa.valorDesconto!='0.00'}"/>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.valorDesconto}" rendered="#{despesaBean.despesadebito.IDDespesa.valorDesconto!='0.00'}">
                                    <f:convertNumber maxFractionDigits="2" minFractionDigits="2"/>
                                </h:outputText>
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.DTDesconto==null?'':'limite '}" rendered="#{despesaBean.despesadebito.IDDespesa.valorDesconto!='0.00'}" />
                                <h:outputText value="#{despesaBean.despesadebito.IDDespesa.DTDesconto}" rendered="#{despesaBean.despesadebito.IDDespesa.DTDesconto!=null and despesaBean.despesadebito.IDDespesa.valorDesconto!='0.00'}" >
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                                <h:outputText value="" rendered="#{despesaBean.despesadebito.IDDespesa.DTDesconto==null?true:false}" />
                            </h:panelGrid>
                            <br/>
                            <h:outputText value="valor liquido: "/>
                            <h:outputText value="#{despesaBean.despesadebito.IDDespesa.valorLiquido}" styleClass="azul">
                                <f:convertNumber minFractionDigits="2"/>
                            </h:outputText>
                            <br/>
                            <h:outputText value="Valor nominal: "/>
                            <h:outputText value="#{despesaBean.despesadebito.IDDespesa.valorNominal}" styleClass="azul">
                            </h:outputText>
                            <p:separator/>

                            <h:panelGrid columns="2" id="gridNumeroDoc_1">

                                <h:outputText value="Tipo documento : "/>
                                <p:selectOneMenu converter="documentoConverter" value="#{despesaBean.despesadebito.IDDebito.IDTpDocumento}" required="true" requiredMessage="tipo de documento e obrigatório!">
                                    <f:selectItem itemLabel=""/>
                                    <f:selectItems value="#{documentoRN.listar()}"
                                                   var="doc"
                                                   itemLabel="#{doc.descricao}"
                                                   itemValue="#{doc}"/>
                                    <p:ajax update="gridNumeroDoc_1"/>
                                </p:selectOneMenu>
                                <h:outputText value="numero doc : " rendered="#{despesaBean.despesadebito.IDDebito.IDTpDocumento.IDDocumento!=2?true:false}"/>
                                <p:inputText  value="#{despesaBean.despesadebito.IDDebito.numero}" rendered="#{despesaBean.despesadebito.IDDebito.IDTpDocumento.IDDocumento!=2?true:false}" required="true" requiredMessage="numero documento é obrigatório!"/>
                            </h:panelGrid>
                            <p:separator/>
                            <h:panelGrid columns="2">
                                <h:outputText value="Conta : "/>
                                <p:selectOneMenu converter="contaConverter" value="#{despesaBean.despesadebito.IDDebito.IDConta}" required="true" requiredMessage="conta e obrigatório!">
                                    <f:selectItem itemLabel=""/>
                                    <f:selectItems var="conta"
                                                   value="#{contaRN.listar()}"
                                                   itemLabel="#{conta.titular} / Banco : #{conta.IDBanco.descricao}"
                                                   itemValue="#{conta}"/>
                                </p:selectOneMenu>

                                <h:outputText value="obs. : "/>
                                <p:inputTextarea value="#{despesaBean.despesadebito.IDDebito.obs}" rows="2" cols="60"/>
                            </h:panelGrid>
                            <h:outputText value="valor pago: "/>
                            <p:inputText value="#{despesaBean.valorPago}"  required="true" requiredMessage="valor obrigatorio!">
                                    <f:convertNumber  maxFractionDigits="2"/>
                            </p:inputText>
                            <h:outputText value="  Data Pag:"/>
                            <p:calendar value="#{despesaBean.despesadebito.IDDebito.DTBaixa}"
                                                showOn="button" 
                                                pattern="dd/MM/yyyy"
                                                size="8"
                                                validatorMessage="data emição em formato errado "
                                                required="true"
                                                requiredMessage="Data baixa e obrigatorio!"/>
                            <p:separator/>
                            <p:commandButton value="confirmar" actionListener="#{despesaBean.pagandoDespesa(event)}" update=":forPagar_debito:panelConfirPagDebito" onstart="statusDialog.show();" onsuccess="statusDialog.hide();"/>
                            <p:commandButton value="sair" onclick="varDialogDespesaPagar.hide();"/>
                        </p:panel>
                    </p:dialog>

                </h:form>
            </f:view>
        </ui:define>

    </ui:composition>
</html>